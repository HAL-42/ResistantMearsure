C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\LCD1602.obj
COMPILER INVOKED BY: D:\Kell\C51\BIN\C51.EXE ..\Src\LCD1602.c BROWSE DEBUG OBJECTEXTEND PRINT(.\LCD1602.lst) OBJECT(.\LC
                    -D1602.obj)

line level    source

   1          #include "RM.h"
   2          #include "LCD1602.h"
   3          
   4          #define DataPort P2
   5          
   6          sbit RS=P3^2;
   7          sbit RW=P3^3;
   8          sbit EN=P3^4;
   9          sbit isBusy=P2^7;                       //è¿”å›LCD1602æ˜¯å¦æ­£å¿™
  10          
  11          #define rs RS
  12          #define rw RW
  13          #define en EN
  14          
  15          #define ICON_HEIGHT                                                                                                     //è‡ªå®šä¹‰å­—ç¬¦é«˜åº¦
  16          uchar funnelIcon[]={0x1F,0x11,0x1B,0x0A,0x0A,0x0A,0x04,0x04};           //è‡ªå®šä¹‰å­—ç¬¦ï¼šæ¼æ–—
  17          
  18          uchar tmp[10];                                                                                                          //å…¬ç”¨ä¸´æ—¶æ•°ç»„
  19          int intPart;                                                                                                            //å…¬ç”¨æ•´æ•°éƒ¨åˆ†ä¸´æ—¶å‚¨å­˜
  20          int decPart;                                                                                                            //å…¬ç”¨å°æ•°éƒ¨åˆ†ä¸´æ—¶å‚¨å­˜
  21          
  22          /**
  23           * æµ‹è¯•LCD1602æ˜¯å¦æ­£å¤„äºå¿™ç¢ŒçŠ¶æ€
  24           * @Author   Xiaobo        Yang
  25           * @DateTime 2018-07-15
  26           * @Summury       Omitted
  27           * @return   è¿”å›1ä»¥è¡¨ç¤ºæ­£åœ¨å¿™ç¢Œ.
  28           */
  29          bit BusyTest(){
  30   1              bit result;
  31   1              rs=0;
  32   1              rw=1;
  33   1              en=1;                            //LCD1602è¯»å‘½ä»¤æ—¶enåº”è¯¥æ˜¯é«˜ç”µå¹³
  34   1              _nop_();             //å»¶è¿Ÿ4ä¸ªæœºå™¨å‘¨æœŸï¼Œç»™LCD1602ååº”æ—¶é—´
  35   1              _nop_();                         //ï¼ï¼å¯èƒ½éœ€è¦æ›´é•¿çš„ååº”æ—¶é—´ï¼Œä½†è¯¥å‡½æ•°è°ƒç”¨é¢‘ç¹ï¼Œæ•ˆç‡è¦å°½å¯èƒ½çš„é
             -«˜æ‰å¥½
  36   1              _nop_();
  37   1              _nop_();
  38   1              result=isBusy;
  39   1              en=0;                            //enæ¢å¤åˆ°0
  40   1              return result;
  41   1      }
  42          /**
  43           * å‘LCD1602å†™å…¥æŒ‡ä»¤
  44           * @Author   Xiaobo     Yang
  45           * @DateTime 2018-07-15
  46           * @Summury  Omitted
  47           * @param    CMD        8bitæŒ‡ä»¤
  48           */
  49          void LCDWriteCommand(uchar CMD){
  50   1              while(BusyTest());
  51   1              rs=0;
  52   1              rw=0;
  53   1              en=0;
C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 2   

  54   1              DataPort=CMD;
  55   1              _nop_();                        
  56   1              _nop_();
  57   1              _nop_();
  58   1              _nop_();
  59   1              en=1;                           //è®©enäº§ç”Ÿä»0åˆ°1çš„è·³å˜ï¼Œå†™å…¥æŒ‡ä»¤
  60   1              _nop_();                        
  61   1              _nop_();
  62   1              _nop_();
  63   1              _nop_();                        
  64   1              en=0;                           //enä¸‹é™æ²¿ï¼ŒLCD1602æ‰§è¡ŒæŒ‡ä»¤
  65   1      }
  66          /**
  67           * ç§»åŠ¨LCD1602æ˜¾ç¤ºä½ç½®
  68           * @Author   Xiaobo     Yang
  69           * @DateTime 2018-07-15
  70           * @Summury  
  71           * @param    x          xåæ ‡ï¼Œåœ¨0~15ä¹‹é—´
  72           * @param    y          yåæ ‡ï¼Œåªæœ‰0,1ä¸¤ç§é€‰æ‹©
  73           */
  74          void LCDMoveCursor(uchar x,uchar y){
  75   1              uchar co;
  76   1              co=x;
  77   1              if(y){
  78   2                      co|=0xc0;
  79   2              }
  80   1              else{
  81   2                      co|=0x80;
  82   2              }
  83   1              LCDWriteCommand(co);
  84   1      }
  85          /**
  86           * å‘LCD1602å†™å…¥æ•°æ®ï¼Œè®©LCD1602åœ¨å…‰æ ‡ä½ç½®æ‰“å‡ºè¾“å…¥çš„å­—ç¬¦
  87           * @Author   Xiaobo     Yang
  88           * @DateTime 2018-07-15
  89           * @Summury
  90           * @param    data       è¦æ˜¾ç¤ºçš„å­—ç¬¦çš„ASCIIç 
  91           */
  92          void LCDWriteData(uchar x){
  93   1              while(BusyTest());
  94   1              rs=1;
  95   1              rw=0;
  96   1              en=0;
  97   1              DataPort=x;
  98   1              _nop_();                        
  99   1              _nop_();
 100   1              _nop_();
 101   1              _nop_();
 102   1              en=1;                           //è®©enäº§ç”Ÿä»0åˆ°1çš„è·³å˜ï¼Œå†™å…¥æ•°æ®
 103   1              _nop_();                        
 104   1              _nop_();
 105   1              _nop_();
 106   1              _nop_();                        
 107   1              en=0;                           //enä¸‹é™æ²¿ï¼ŒLCD1602å¼€å§‹è¾“å‡º
 108   1      }
 109          /**
 110           * Initialte LCD1602
 111           * @Author   Xiaobo     Yang
 112           * @DateTime 2018-07-16
 113           * @Summury
 114           */
 115          void LcdInitiate(void)
C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 3   

 116          {
 117   1              delaynms(15);                           //å»¶æ—¶15msï¼Œé¦–æ¬¡å†™æŒ‡ä»¤æ—¶åº”ç»™LCD ä¸€æ®µè¾ƒé•¿çš„ååº”æ—¶é—´
 118   1              LCDWriteCommand(0x38);          //æ˜¾ç¤ºæ¨¡å¼è®¾ç½®ï¼š 16Ã— 2 æ˜¾ç¤ºï¼Œ 5Ã— 7 ç‚¹é˜µï¼Œ 8 ä½æ•°æ®æ¥å£
 119   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 120   1              LCDWriteCommand(0x38);
 121   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 122   1              LCDWriteCommand(0x38);          //è¿ç»­ä¸‰æ¬¡ï¼Œç¡®ä¿åˆå§‹åŒ–æˆåŠŸ
 123   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 124   1              LCDWriteCommand(0x0c);          //æ˜¾ç¤ºæ¨¡å¼è®¾ç½®ï¼šæ˜¾ç¤ºå¼€ï¼Œæ— å…‰æ ‡ï¼Œå…‰æ ‡ä¸é—ªçƒ
 125   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 126   1              LCDWriteCommand(0x06);          //æ˜¾ç¤ºæ¨¡å¼è®¾ç½®ï¼šå…‰æ ‡å³ç§»ï¼Œå­—ç¬¦ä¸ç§»
 127   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 128   1              LCDWriteCommand(0x40);          //å†™å…¥è‡ªå®šä¹‰å­—ç¬¦
 129   1              uchar i;                                        
*** ERROR C141 IN LINE 129 OF ..\SRC\LCD1602.C: syntax error near 'unsigned'
*** ERROR C202 IN LINE 129 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 130   1              for(i=0;i<8;i++){
*** ERROR C202 IN LINE 130 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 131   2                      LCDWriteData(funnelIcon[i]);
*** ERROR C202 IN LINE 131 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 132   2                      }
 133   1              LCDWriteCommand(0x01);          //æ¸…å±å¹•æŒ‡ä»¤ï¼Œå°†ä»¥å‰çš„æ˜¾ç¤ºå†…å®¹æ¸…é™¤
 134   1              delaynms(5);                            //å»¶æ—¶5ms ï¼Œç»™ç¡¬ä»¶ä¸€ç‚¹ååº”æ—¶é—´
 135   1              LCDMoveCursor(0,0);
 136   1      }
 137          /**
 138           * æ¸…å±å‡½æ•°
 139           * @Author   Xiaobo     Yang
 140           * @DateTime 2018-07-15
 141           * @Summury
 142           */
 143          void LCDCls(){
 144   1              LCDWriteCommand(0x01);
 145   1      }
 146          /**
 147           * åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦
 148           * @Author   Xiaobo     Yang
 149           * @DateTime 2018-07-15
 150           * @Summury
 151           * @param    x          å­—ç¬¦çš„xåæ ‡ï¼Œåœ¨0~15ä¹‹é—´
 152           * @param    y          å­—ç¬¦çš„yåæ ‡ï¼Œåœ¨0~1ä¹‹é—´
 153           * @param    c          è¦æ˜¾ç¤ºå­—ç¬¦çš„ASCIIç 
 154           */
 155          void LCDPrintChar(uchar x,uchar y,uchar c){
 156   1              LCDMoveCursor(x,y);
 157   1              LCDWriteData(c);
 158   1      }
 159          /**
 160           * åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªæ•´æ•°
 161           * @Author   Xiaobo     Yang
 162           * @DateTime 2018-07-18
 163           * @Summury
 164           * @param    x          å­—ç¬¦çš„xåæ ‡ï¼Œåœ¨0~15ä¹‹é—´
 165           * @param    y          å­—ç¬¦çš„yåæ ‡ï¼Œåœ¨0~1ä¹‹é—´
 166           * @param    num        è¦æ˜¾ç¤ºæ•´æ•°
 167           */
 168          void LCDPrintNum(uchar x,uchar y,int num){
 169   1              LCDMoveCursor(x,y);
 170   1              uchar i=0;
*** ERROR C141 IN LINE 170 OF ..\SRC\LCD1602.C: syntax error near 'unsigned'
*** ERROR C202 IN LINE 170 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 171   1              do{
C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 4   

 172   2                      tmp[i++]=num%10;
*** ERROR C202 IN LINE 172 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 173   2                      num/=10;
 174   2              }while(num);
 175   1              while(i){
*** ERROR C202 IN LINE 175 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 176   2                      LCDWriteData(tem[--i]+'0');
*** ERROR C202 IN LINE 176 OF ..\SRC\LCD1602.C: 'i': undefined identifier
 177   2              }
 178   1      }
 179          /**
 180           * åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œä¸‰ä½æ•´æ•°ï¼Œä¸‰ä½å°æ•°ï¼Œæ•°é‡çº§ä»¥10E3é€’å¢ï¼Œå¤§äº999
             -Må®šä¹‰ä¸ºæ— ç©·
 181           * @Author   Xiaobo     Yang
 182           * @DateTime 2018-07-18
 183           * @Summury
 184           * @param    x          å­—ç¬¦çš„xåæ ‡ï¼Œåœ¨0~15ä¹‹é—´
 185           * @param    y          å­—ç¬¦çš„yåæ ‡ï¼Œåœ¨0~1ä¹‹é—´
 186           * @param    num        è¦æ˜¾ç¤ºæ•´æ•°
 187           */
 188          void LCDPrintFloat(uchar x,uchar y,float num){
 189   1              LCDMoveCursor(x,y);
 190   1              if(num>=1e9){
 191   2                      LCDPrintStr("Infinite");
 192   2              }
 193   1              else if(num>=1e6){
 194   2                      num/=1e6;
 195   2                      intPart=(int) num;
 196   2                      decPart=(int) (num-intPart)*1000;
 197   2                      LCDPrintNum(intPart);
 198   2                      LCDWriteData('.');
 199   2                      LCDPrintNum(decPart);
 200   2                      LCDWriteData('M');
 201   2              }
 202   1              else if(num>1e3){
 203   2                      num/=1e3;
 204   2                      intPart=(int) num;
 205   2                      decPart=(int) (num-intPart)*1000;
 206   2                      LCDPrintNum(intPart);
 207   2                      LCDWriteData('.');
 208   2                      LCDPrintNum(decPart);
 209   2                      LCDWriteData('K');
 210   2              }
 211   1              else{
 212   2                      intPart=(int) num;
 213   2                      decPart=(int) (num-intPart)*10000;
 214   2                      LCDPrintNum(intPart);
 215   2                      LCDWriteData('.');
 216   2                      LCDPrintNum(decPart);
 217   2              }
 218   1      }
 219          /**
 220           * åœ¨æŒ‡å®šä½ç½®æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²
 221           * @Author   Xiaobo     Yang
 222           * @DateTime 2018-07-15
 223           * @Summury
 224           * @param    x          å­—ç¬¦ä¸²èµ·å§‹xåæ ‡ï¼Œåœ¨0~15ä¹‹é—´
 225           * @param    y          å­—ç¬¦ä¸²èµ·å§‹yåæ ‡ï¼Œåœ¨0~1ä¹‹é—´
 226           * @param    str        è¦æ˜¾ç¤ºå­—ç¬¦ä¸²
 227           */
 228          void LCDPrintStr(uchar x,uchar y,uchar str[]){
 229   1              LCDMoveCursor(x,y);
C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 5   

 230   1              while(*str){
 231   2                      LCDWriteData(*str);
 232   2                      str++;
 233   2              }
 234   1      }
 235          /**
 236           * æ‰“å°ä¸€è¡Œï¼Œä»åˆå§‹åæ ‡xï¼Œyå¼€å§‹ï¼Œå…ˆæ¸…é™¤è¦æ‰“å°è¡ŒåŸæœ‰æ‰€æœ‰å­—ç¬¦ï¼Œç„¶åæ˜¾ç¤ºè¾“å…
             -¥çš„å­—ç¬¦
 237           * @Author   Xiaobo     Yang
 238           * @DateTime 2018-07-15
 239           * @Summury
 240           * @param    x          å­—ç¬¦æ˜¾ç¤ºèµ·å§‹æ¨ªåæ ‡
 241           * @param    y          å­—ç¬¦æ˜¾ç¤ºèµ·å§‹çºµåæ ‡
 242           * @param    str        è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²
 243           */
 244          void LCDPrintLine(uchar x,uchar y,uchar str[]){
 245   1              LCDMoveCursor(0,y);
 246   1              uchar i;
 247   1              for(i=0;i<0x10;i++) LCDWriteData(0x20);
 248   1              LCDMoveCursor(x,y);
 249   1              while(*str){
 250   2                      LCDWriteData(*str);
 251   2                      str++;
 252   2              }
 253   1      }
 254          /**
 255           * æ‰“å°ä¸¤è¡Œå­—åœ¨å±å¹•ä¸Š
 256           * @Author   Xiaobo     Yang
 257           * @DateTime 2018-07-19
 258           * @Summury
 259           * @param    str1       ç¬¬ä¸€è¡Œå­—
 260           * @param    str2       ç¬¬äºŒè¡Œå­—
 261           */
 262          void LCDPrintScreen(uchar str1[],uchar str2[]){
 263   1              LCDWriteCommand(0x01);
 264   1              LCDMoveCursor(0,0);
 265   1              while(*str1){
 266   2                      LCDWriteData(*str1++);
 267   2              }
 268   1              LCDMoveCursor(0,1);
 269   1              while(*str2){
 270   2                      LCDWriteData(*str2++);
 271   2              }
 272   1      }
 273          /**
 274           * ä»åæ ‡xï¼Œyå¼€å§‹æ¸…é™¤é•¿åº¦ä¸ºlençš„å­—ç¬¦
 275           * @Author   Xiaobo     Yang
 276           * @DateTime 2018-07-15
 277           * @Summury
 278           * @param    x          æ¸…é™¤å¼€å§‹æ¨ªåæ ‡x
 279           * @param    y          æ¸…é™¤å¼€å§‹çºµåæ ‡y
 280           * @param    len        è¦æ¸…é™¤çš„é•¿åº¦
 281           */
 282          void LCDErase(uchar x,uchar y,uchar len){
 283   1              LCDMoveCursor(x,y);
 284   1              uchar i;
 285   1              for(i=0;i<len;i++) LCDWriteData(0x20);
 286   1      }
 287          /**
 288           * æ‰“å¼€æ˜¾ç¤ºå±å¹¶æ˜¾ç¤ºé—ªçƒçš„å…‰æ ‡ã€‚
 289           * @Author   Xiaobo     Yang
 290           * @DateTime 2018-07-15
C51 COMPILER V9.01   LCD1602                                                               07/19/2018 11:02:08 PAGE 6   

 291           * @Summury
 292           */
 293          void cursor_show_LCD1602(){
 294   1              LCDWriteCommand(0x0f);
 295   1      }
 296          /**
 297           * éšè—å…‰æ ‡ã€‚
 298           * @Author   Xiaobo     Yang
 299           * @DateTime 2018-07-15
 300           * @Summury
 301           */
 302          void cursor_hide_LCD1602(){
 303   1              LCDWriteCommand(0x0c);
 304   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  9 ERROR(S)
