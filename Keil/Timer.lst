C51 COMPILER V9.01   TIMER                                                                 07/19/2018 11:19:30 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Timer.obj
COMPILER INVOKED BY: D:\Kell\C51\BIN\C51.EXE ..\Src\Timer.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Timer.lst) OBJECT(.\Timer.
                    -obj)

line level    source

   1          #include "RM.h"
   2          #include "Timer.h"
   3          
   4          extern uchar timerFun;
   5          
   6          extern sbit capSel;                     //ç”µå®¹é€‰æ‹©æ¥å£
*** ERROR C141 IN LINE 6 OF ..\SRC\TIMER.C: syntax error near 'sbit'
   7          extern bit isTimerEvent;                        //è®°å½•æ˜¯å¦æœ‰å®šæ—¶å™¨äº‹ä»¶å‘ç”Ÿï¼ˆå®Œæˆä¸€æ¬¡é¢‘ç‡æµ‹é‡ï¼‰
*** ERROR C202 IN LINE 7 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
   8          extern long curN;                                       //å½“å‰æµ‹å¾—è„‰å†²æ•°
   9          extern long curFreqE5;                          //å½“å‰æµ‹å¾—é¢‘ç‡
  10          extern float curRValue;                         //è®°å½•å½“å‰æµ‹å¾—ç”µé˜»é˜»å€¼
  11          extern long refLowRN;                           //ä½æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  12          extern long refHighRN;                          //é«˜æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  13          
  14          uchar t0IntrTimes;                                      //T0ç”¨äºè®¡æ—¶ï¼ŒT1ç”¨äºè®¡æ•°ï¼Œä¸¤ä¸ªå˜é‡å‚¨å­˜ä»–ä»¬çš„æº¢å‡ºæ¬¡æ•°
  15          uchar t1IntrTimes;
  16          /**
  17           * è®¾å®šåˆå€¼,ä¸­æ–­å…è®¸,è®¡æ—¶ä¼˜å…ˆï¼Œè®¾å®šTMOD(51)
  18           * @Author   Xiaobo     Yang
  19           * @DateTime 2018-07-18
  20           * @Summury ç”¨äºè½¯é‡è®¾ï¼Œå› æ­¤æ‰€æœ‰å…¨å±€å˜é‡éƒ½éœ€è¦é‡è®¾
  21           */
  22          void InitialTimers(){
  23   1              EA=1;                                                   //å…è®¸ä¸­æ–­ï¼Œå¹¶è®©è®¡æ—¶å™¨çš„ä¸­æ–­ä¼˜å…ˆçº§æœ€é«˜
  24   1              ET0=1;
  25   1              ET1=1;
  26   1              PT0=1;
  27   1              PT1=0;
  28   1              TMOD=0x51;                                              //T0ç”¨äºè®¡æ—¶ï¼ŒT1ç”¨äºè®¡æ•°
  29   1              capSel=CAPSEL_LOWR;                             //é‡ç½®æ‰€æœ‰å…¨å±€å˜é‡
*** ERROR C202 IN LINE 29 OF ..\SRC\TIMER.C: 'capSel': undefined identifier
  30   1              curRValue=0;
  31   1              isTimerEvent=0;
*** ERROR C202 IN LINE 31 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
  32   1              curN=0;
  33   1              curFreq=0;
*** ERROR C202 IN LINE 33 OF ..\SRC\TIMER.C: 'curFreq': undefined identifier
  34   1              refLowRN=0;
  35   1              refHignRN=0;
*** ERROR C202 IN LINE 35 OF ..\SRC\TIMER.C: 'refHignRN': undefined identifier
  36   1              t0IntrTimes=0;
  37   1              t1IntrTimes=0;
  38   1              TH0=TL0=0;
  39   1              TH1=TL1=0;
  40   1              timerFun=TIMERFUN_FREQ_MEASRURE;//è®¡æ—¶å™¨åˆå§‹åŠŸèƒ½ä¸ºé¢‘ç‡æµ‹é‡
  41   1      }
  42          /**
  43           * åˆ‡æ¢è®¡æ—¶å™¨åŠŸèƒ½
  44           * @Author   Xiaobo     Yang
  45           * @DateTime 2018-07-19
  46           * @Summury
  47           * @param    fun        åŠŸèƒ½æè¿°
  48           */
C51 COMPILER V9.01   TIMER                                                                 07/19/2018 11:19:30 PAGE 2   

  49          void SwitchTimerFun(uchar fun){
  50   1              timerFun=fun;
  51   1              TR1=TR0=0;                                                              //åˆ‡æ¢åŠŸèƒ½å‰å…ˆè®©å®šæ—¶å™¨åœæ­¢å·¥ä½œï¼Œä¸‹æ¬¡ä½¿ç”¨æ—¶å¼ºåˆ¶ç”¨StartTimeråˆå§‹
             -åŒ–
  52   1              switch(fun){
  53   2                      case TIMERFUN_FREQ_MEASRURE:            //é¢‘ç‡æµ‹é‡ï¼ŒT1è®¡æ•°ï¼ŒT2è®¡æ—¶
  54   2                              TMOD=0x51;
  55   2                              break;
  56   2                      case TIMERFUN_PWM:                                      //PWMæ³¢è¾“å‡ºæ§åˆ¶èˆµæœºï¼Œä¸¤ä¸ªéƒ½è®¡æ—¶
  57   2                              TMOD=0x11;
  58   2                              break;
  59   2                      case TIMERFUN_KEY_SCAN:                         //é”®ç›˜æ‰«æï¼Œä¸¤ä¸ªéƒ½è®¡æ—¶
  60   2                              TMOD=0x11;
  61   2                              break;
  62   2                      case TIMERFUN_HALT:                                     //é”®ç›˜æ‰«æ
  63   2                              break;
  64   2              }
  65   1      }
  66          /**
  67           * åˆå§‹åŒ–T0,T1;å¼€å¯è®¡æ—¶å™¨ï¼Œå¼€å§‹æµ‹é‡é¢‘ç‡
  68           * @Author   Xiaobo     Yang
  69           * @DateTime 2018-07-18
  70           * @Summury
  71           */
  72          void StartTimer(){
  73   1              isTimerEvent=0;                                                 //ä¿é™©èµ·è§ï¼Œå†é‡ç½®ä¸€æ¬¡æ—¶é’Ÿäº‹ä»¶ï¼Œé˜²æ­¢å®¢æˆ·æ²¡æœ‰ä½¿ç”¨GetRValå‡½æ•
             -°
*** ERROR C202 IN LINE 73 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
  74   1              t0IntrTimes=0;                                          
  75   1              t1IntrTimes=0;
  76   1              switch(timerFun){
  77   2                      case TIMERFUN_FREQ_MEASRURE:
  78   2                              TH0=TL0=0;                                              //è®¡æ—¶å™¨ä»0å¼€å§‹è®¡æ—¶
  79   2                              TH1=TL1=0;                                              //è®¡æ•°å™¨ä»0å¼€å§‹è®¡æ•°
  80   2                              TR0=1;                                                  //å¼€å¯è®¡æ—¶å™¨
  81   2                              TR1=1;                                                  //å¼€å¯è®¡æ•°å™¨
  82   2                              break;
  83   2                      case TIMERFUN_PWM:
  84   2                              /////////
  85   2                              //TODO:NOT FINISHED//
  86   2                              /////////
  87   2                              break;
  88   2                      case TIMERFUN_KEY_SCAN:
  89   2                              //////////////////////
  90   2                              //TODO:NOT FINISHED //
  91   2                              //////////////////////
  92   2                              break;
  93   2                      case TIMERFUN_HALT:
  94   2                              //////////////////////
  95   2                              //TODO:NOT FINISHED //
  96   2                              //////////////////////
  97   2                              break;
  98   2              }
  99   1      }
 100          /**
 101           * T1ä¸­æ–­ï¼Œæº¢å‡ºè®¡æ•°åŠ ä¸€
 102           * @Author   Xiaobo     Yang
 103           * @DateTime 2018-07-18
 104           * @Summury
 105           */
 106          void T1INT() interrupt 3 using 2{
 107   1              switch(timerFun){
C51 COMPILER V9.01   TIMER                                                                 07/19/2018 11:19:30 PAGE 3   

 108   2                      case TIMERFUN_FREQ_MEASRURE:                                    //æº¢å‡ºè®¡æ•°åŠ ä¸€ï¼Œè‡ªåŠ¨é‡è£…
 109   2                              t1IntrTimes++;  
 110   2                              break;                                  
 111   2                      case TIMERFUN_PWM:
 112   2                              /////////
 113   2                              //TODO:NOT FINISHED//
 114   2                              /////////
 115   2                              break;
 116   2                      case TIMERFUN_KEY_SCAN:
 117   2                              //////////////////////
 118   2                              //TODO:NOT FINISHED //
 119   2                              //////////////////////
 120   2                              break;
 121   2                      case TIMERFUN_HALT:
 122   2                              //////////////////////
 123   2                              //TODO:NOT FINISHED //
 124   2                              //////////////////////
 125   2                              break;
 126   2              }
 127   1      }
 128          /**
 129           * T0ä¸­æ–­
 130           * @Author   Xiaobo     Yang
 131           * @DateTime 2018-07-18
 132           * @Summury
 133           */
 134          void T0INT() interrupt 1 using 1{
 135   1              if((capSel==CAPSEL_LOWR)                //è‹¥ä¸ºä½ç”µé˜»æ¡£ä¸”ä¸¤æ¬¡æº¢å‡º
*** ERROR C202 IN LINE 135 OF ..\SRC\TIMER.C: 'capSel': undefined identifier
 136   1                      &&(++t0IntrTimes==2)){
 137   2                      TR1=0;                                          //å…³åœè®¡æ•°å™¨ï¼Œè®¡æ—¶å™¨
 138   2                      TR0=0;
 139   2                      isTimerEvent=1;                         //å‘ŠçŸ¥ä¸»ç¨‹åºå‘ç”Ÿè®¡æ—¶å™¨äº‹ä»¶
*** ERROR C202 IN LINE 139 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
 140   2              }
 141   1              else if((capSel==CAPSEL_HIGHR)  //è‹¥ä¸ºé«˜ç”µé˜»æ¡£ä¸”15æ¬¡æº¢å‡º
*** ERROR C202 IN LINE 141 OF ..\SRC\TIMER.C: 'capSel': undefined identifier
 142   1                      &&(++t0IntrTimes==15)){
 143   2                      TR1=0;                                          //å…³åœè®¡æ•°å™¨ï¼Œè®¡æ—¶å™¨
 144   2                      TR0=0;
 145   2                      isTimerEvent=1;                         //å‘ŠçŸ¥ä¸»ç¨‹åºå‘ç”Ÿè®¡æ—¶å™¨äº‹ä»¶
*** ERROR C202 IN LINE 145 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
 146   2              }
 147   1      }
 148          
 149          /////////
 150          //TODO:é˜²æ­¢æº¢å‡º //
 151          /////////
 152          
 153          /**
 154           * è®¡ç®—è„‰å†²æ•°ï¼Œé¢‘ç‡å’Œç”µé˜»
 155           * @Author   Xiaobo     Yang
 156           * @DateTime 2018-07-18
 157           * @Summury  æœ¬å‡½æ•°ä¸­é­”é¬¼æ•°å­—è¾ƒå¤šï¼Œä¸ºçš„æ˜¯æé«˜è®¡ç®—ç²¾åº¦ã€‚æ‰€æœ‰æ•°æ®éƒ½æ˜¯åœ¨MATLABä¸­
             -è®¡ç®—åå¸¦å…¥ï¼Œåˆ‡å‹¿éšæ„ä¿®æ”¹
 158           */
 159          void GetRVal(){
 160   1              isTimerEvent=0;
*** ERROR C202 IN LINE 160 OF ..\SRC\TIMER.C: 'isTimerEvent': undefined identifier
 161   1              curN=t1IntrTimes*65536+TH1*256+TL1; // è®¡ç®—è„‰å†²æ¬¡æ•°
 162   1              if(capSel==CAPSEL_LOWR){
*** ERROR C202 IN LINE 162 OF ..\SRC\TIMER.C: 'capSel': undefined identifier
C51 COMPILER V9.01   TIMER                                                                 07/19/2018 11:19:30 PAGE 4   

 163   2                      curFreqE5=703125*curN;
 164   2                      curRValue=1.69065825104e9F*( (refLowRN-curN)/(refLowRN*curN) );
 165   2              }
 166   1              else{
 167   2                      curFreqE5=93750*curN;
 168   2                      curRValue=1.53887471028e11F*( (refHighRN-curN)/(refHighRN*curN) );
 169   2              }
 170   1      }

C51 COMPILATION COMPLETE.  0 WARNING(S),  13 ERROR(S)
