C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/22/2018 12:06:15 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE RESISTANTMEASURE
OBJECT MODULE PLACED IN .\ResistantMeasure.obj
COMPILER INVOKED BY: D:\Kell\C51\BIN\C51.EXE ..\Src\ResistantMeasure.c BROWSE DEBUG OBJECTEXTEND PRINT(.\ResistantMeasur
                    -e.lst) OBJECT(.\ResistantMeasure.obj)

line level    source

   1          #include "RM.h"
   2          #include "LCD1602.h"
   3          #include "Key.h"
   4          #include "Timer.h"
   5          #include "Menu.h"
   6          #include "CalcR.h"
   7          
   8          //----------------------------LEDå…³å…¨å±€å˜é‡-------------------------------//
   9          sbit    Led1 = P1^0;
  10          sbit    Led2 = P1^1;
  11          sbit    Led3 = P1^2;
  12          
  13          //-------------------------æŒ‰é”®ç›¸å…³å…¨å±€å˜é‡-------------------------------//
  14          sbit key1=P1^5;                         //æ³¨æ„ä½ç”µå¹³è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹
  15          sbit key2=P1^4;
  16          sbit key3=P1^3;
  17          
  18          uchar key1Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  19          uchar key2Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  20          uchar key3Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  21          
  22          bit isKeyEvents;                        //è®°å½•æ˜¯å¦æœ‰æŒ‰é”®äº‹ä»¶å‘ç”Ÿ 
  23          
  24          //-------------------------ç”µé˜»è®¡ç®—ç›¸å…³å…¨å±€å˜é‡-----------------------------//
  25          sbit  capSel=P3^7;                                      //ç”µå®¹é€‰æ‹©æ¥å£
  26          bit   isLongMeasr;
  27          bit   isAverg;
  28          float idata curRValue;                          //å½“å‰æµ‹å¾—ç”µé˜»é˜»å€¼
  29          unsigned long  idata curN;                      //å½“å‰æµ‹å¾—è„‰å†²æ•°
  30          unsigned long  idata refLowRN;          //ä½æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  31          unsigned long  idata refHighRN;         //é«˜æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  32          
  33          code char *mearsStr="Mearsuring...";
  34          //-------------------------è®¡æ—¶å™¨ç›¸å…³å…¨å±€å˜é‡-----------------------------//
  35          uchar timerFun;                         //é€‰æ‹©è®¡æ—¶å™¨ä½œç”¨
  36          bit   isTimerEvent;                     //è®°å½•æ˜¯å¦æœ‰å®šæ—¶å™¨äº‹ä»¶å‘ç”Ÿï¼ˆå®Œæˆä¸€æ¬¡é¢‘ç‡æµ‹é‡ï¼‰
  37          extern uchar t1IntrTimes;
  38          extern uchar t0IntrTimes;
  39          //-------------------------ç­›é€‰å™¨ç›¸å…³å…¨å±€å˜é‡-----------------------------//
  40          bit   isSieveOn;                        //ç­›é€‰å™¨æ˜¯å¦æ‰“å¼€
  41          float errTolr;                          //ç­›é€‰å™¨å…è®¸è¯¯å·®
  42          float sieveRVal;                        //ç­›é€‰å™¨ä¸­å¿ƒå€¼
  43          
  44          //-------------------------è°ƒè¯•æ¨¡å¼ç›¸å…³å…¨å±€å˜é‡---------------------------//
  45          bit isDebug=1;                          //æ˜¯å¦å¤„äºè°ƒè¯•æ¨¡å¼
  46          
  47                  ///////////////////
  48                  //TODO:å®Œå–„ä»¥ä¸‹å‡½æ•° //
  49                  ///////////////////
  50          void InitialSys();
  51          void SetZero();
  52          void KeyEventsCallBack();
  53          void TimerEventsCallBack();
  54          
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/22/2018 12:06:15 PAGE 2   

  55          void main(){
  56   1              InitialSys();
  57   1              SetZero();
  58   1              isLongMeasr=0;
  59   1              StartTimer();
  60   1              capSel=CAPSEL_HIGHR;
  61   1              delaynms(1000);
  62   1              while(1){
  63   2                      KeyScan();
  64   2                      if(isKeyEvents)  KeyEventsCallBack();
  65   2                      if(isTimerEvent) TimerEventsCallBack();
  66   2              }
  67   1      }
  68          
  69          void InitialSys(){
  70   1              //å®šä¹‰ç«¯å£è¾“å…¥è¾“å‡º,p1^0-P1^2ä¸ºæ¨æŒ½è¾“å‡ºï¼Œp1^3-P1^7ä¸ºè¾“å…¥ï¼Œè®¾ç½®PxM0ï¼ŒPxM1ï¼›å…³é—­å„ä
             -¸ªLED
  71   1              P1M1 = 0x47;                                                            //8'b01000111
  72   1              P1M0 = 0xb8;                                                            //8'b10111000
  73   1              P3M1 = 0x00;                                                            //8'b00000000
  74   1              P3M0 = 0x20;                                                            //8'b00100000
  75   1              Led1=Led2=Led3=0;
  76   1              //åˆå§‹åŒ–å…¶ä»–å¤–å›´è®¾å¤‡
  77   1              LcdInitiate();
  78   1              InitialTimers();                                                        //åˆå§‹åŒ–è®¡æ—¶å™¨    
  79   1              KeyInitial();                                                           //åˆå§‹åŒ–é”®ç›˜
  80   1              //åˆå§‹åŒ–èœå•ä¸ç”µé˜»è®¡ç®—æ‰€éœ€å˜é‡
  81   1              InitialMenu();
  82   1              InitialCalcR();
  83   1      }
  84          
  85          void SetZero(){
  86   1              capSel=CAPSEL_LOWR;
  87   1              isLongMeasr=1;
  88   1      
  89   1              LCDPrintScreen("Cross Probes And","Press Any Button");
  90   1              PressAnyKey();                                                                                          //ç­‰å¾…ç”¨æˆ·æŒ‰ç…§æŒ‡ç¤ºçŸ­æ¥çº¢é»‘è¡¨ç¬”
  91   1              LCDPrintScreen(mearsStr,"Please Wait");
  92   1              
  93   1              StartTimer();                                                                                           //å¼€å§‹é‡‡æ ·
  94   1              while(!isTimerEvent);
  95   1              GetRVal();                                                                                                      //ä½æ¡£ä½é‡‡æ ·ç»“æŸï¼Œç®—å‡ºä½æ¡£ä½ä¸‹çš„â€œæ ‡å‡†Nâ€
  96   1              refLowRN=curN;
  97   1      
  98   1              LCDPrintScreen("Press Any Button","To Switch Cap");
  99   1              PressAnyKey();
 100   1              capSel=CAPSEL_HIGHR;                                                                            //è®¾å®šåˆ°é«˜æ¡£ä½ï¼Œå¹¶ç­‰å¾…1ç§’ï¼Œè®©ç»§ç”µå™¨ååº”è¿‡æ¥
 101   1              delaynms(1000);
 102   1              StartTimer();                                                                                           //é«˜æ¡£ä½é‡‡æ ·
 103   1              while(!isTimerEvent);
 104   1              GetRVal();
 105   1              refHighRN=curN;
 106   1              
 107   1              LCDPrintScreen("Set Zero","Finished");                                          //è°ƒ0å®Œæ¯•
 108   1              capSel=CAPSEL_LOWR;
 109   1              delaynms(1000);
 110   1              if(isDebug){                                                                                            //è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºè°ƒ0æµ‹é‡ç»“æœ
 111   2                      LCDCls();
 112   2                      LCDPrintStr(0,0,"LOW");
 113   2                      LCDPrintNum(6,0,refLowRN);
 114   2                      LCDPrintStr(0,1,"HIGH");
 115   2                      LCDPrintNum(6,1,refHighRN);
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/22/2018 12:06:15 PAGE 3   

 116   2                      PressAnyKey();
 117   2              }
 118   1      }
 119          
 120          void KeyEventsCallBack(){
 121   1              switch(key1Events){
 122   2                      case SHORT_PRESS:
 123   2                              isDebug=!isDebug;                                                               //çŸ­æŒ‰æ”¹å˜è°ƒè¯•
 124   2                              break;
 125   2                      case LONG_PRESS:
 126   2                              isSieveOn=!isSieveOn;                                                   //é•¿æŒ‰æ”¹å˜ç­›é€‰æ¨¡å¼
 127   2                              break;
 128   2                      default:
 129   2                              break;
 130   2              }
 131   1              switch(key2Events){
 132   2                      case SHORT_PRESS:
 133   2                              KeyInitial();                                                                   //åˆå§‹åŒ–å¤–è®¾ï¼Œè¿›å…¥å­ç¨‹åº
 134   2                              SwitchTimerFun(TIMERFUN_HALT);
 135   2                              MenuImpl();                                                                             //èœå•å¤„ç†å­ç¨‹åº
 136   2                              SwitchTimerFun(TIMERFUN_FREQ_MEASRURE);                 //é€€å‡ºå­ç¨‹åºï¼Œå¤–è®¾å½’ä½
 137   2                              StartTimer();
 138   2                              KeyInitial();
 139   2                              LCDCls();
 140   2                              LCDPrintStr(0,0,"Processing...");
 141   2                              break;
 142   2                      case LONG_PRESS:        
 143   2                              Led3=Led2=Led1=0;                                                               //é•¿æŒ‰å…³ç¯
 144   2                              break;
 145   2                      default:
 146   2                              break;
 147   2              }
 148   1              switch(key3Events){
 149   2                      case SHORT_PRESS:
 150   2                              KeyInitial();
 151   2                              SwitchTimerFun(TIMERFUN_HALT);
 152   2                              MenuOpRstDev();
 153   2                              break;
 154   2                      case LONG_PRESS:
 155   2                              Led3=Led2=Led1=1;                                                               //é•¿æŒ‰å¼€ç¯
 156   2                              break;
 157   2                      default:
 158   2                              break;
 159   2              }
 160   1              RstKeyEvents();
 161   1      }
 162          
 163          void TimerEventsCallBack(){
 164   1              GetRVal();
 165   1              StartTimer();
 166   1              LCDCls();
 167   1              LCDPrintStr(0,0,"R=");
 168   1              LCDPrintFloat(2,0,curRValue);
 169   1              if(isDebug){
 170   2                      LCDPrintNum(8,1,curN);
 171   2              }
 172   1              else{
 173   2                      LCDErase(8,1,8);
 174   2              }
 175   1              if(isSieveOn){
 176   2                      LCDPrintChar(15,0,0x00);
 177   2                      if( (curRValue-sieveRVal)/sieveRVal < errTolr &&
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/22/2018 12:06:15 PAGE 4   

 178   2                              (curRValue-sieveRVal)/sieveRVal > -errTolr ){
 179   3                              LCDPrintStr(0,1,"In ");
 180   3                      }
 181   2                      else{
 182   3                              LCDPrintStr(0,1,"Out");
 183   3                      }
 184   2              }
 185   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    607    ----
   CONSTANT SIZE    =    129    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =     16    ----
   BIT SIZE         =      6    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
