C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/19/2018 13:55:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE RESISTANTMEASURE
OBJECT MODULE PLACED IN .\ResistantMeasure.obj
COMPILER INVOKED BY: D:\Kell\C51\BIN\C51.EXE ..\Src\ResistantMeasure.c BROWSE DEBUG OBJECTEXTEND PRINT(.\ResistantMeasur
                    -e.lst) OBJECT(.\ResistantMeasure.obj)

line level    source

   1          //这是一个测试版本
   2          
   3          
   4          #include "RM.h"
   5          #include "LCD1602.h"
   6          #include "Key.h"
   7          #include "Timer.h"
   8          
   9          //----------------------------LED关全局变量-------------------------------//
  10          sbit    Led1 = P1^0;
  11          sbit    Led2 = P1^1;
  12          sbit    Led3 = P1^2;
  13          
  14          //-------------------------按键相关全局变量-------------------------------//
  15          sbit key1=P1^5;                                 //注意低电平表示按键按下
  16          sbit key2=P1^4;
  17          sbit key3=P1^3;
  18          
  19          uchar key1Events;                       //保存Key1未处理的输入信号
  20          uchar key2Events;                       //保存Key1未处理的输入信号
  21          uchar key3Events;                       //保存Key1未处理的输入信号
  22          
  23          bit isKeyEvents;                        //记录是否有按键事件发生
  24          
  25          //-------------------------计时器相关全局变量-----------------------------//
  26          uchar timerFun;                         //选择计时器作用
  27          
  28          sbit capSel=P2^4;                       //电容选择接口
  29          float curRValue;                                //当前测得电阻阻值
  30          bit isTimerEvent;                       //记录是否有定时器事件发生（完成一次频率测量）
  31          long curN;                                      //当前测得脉冲数
  32          float curFreqE5;                                //当前测得频率
  33          long refLowRN;                          //低档位下参考脉冲数
  34          long refHighRN;                         //高档位下参考脉冲数
  35          
  36          //-------------------------筛选器相关全局变量-----------------------------//
  37          uchar filterCon;
  38          bit filterEn;
  39          
  40          //-------------------------调试模式相关全局变量---------------------------//
  41          bit IsDebug=1;                          //是否处于调试模式
  42          
  43                  ///////////////////
  44                  //TODO:完善以下函数 //
  45                  ///////////////////
  46          void SetZero();
  47          void KeyEventsCallBack();
  48          void TimerEventsCallBack();
  49          
  50          void main(){
  51   1              //定义端口输入输出,p1^0-P1^2为推挽输出，p1^3-P1^7为输入，设置PxM0，PxM1
  52   1              P1M0 = 0xf8;                                                            //#11111000b
  53   1              P1M1 = 0x07;                                                            //#00000111b
  54   1              //初始化其他外围设备
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/19/2018 13:55:33 PAGE 2   

  55   1              InitialTimers();                                                        //初始化计时器    
  56   1              KeyInitial();                                                           //初始化键盘
  57   1              LcdInitiate();                                                          //初始化LCD1602显示屏
  58   1              SetZero();
  59   1      
  60   1              StartTimer();
  61   1              while(1){
  62   2                      KeyScan();
  63   2                      if(isKeyEvents) KeyEventsCallBack();
  64   2                      if(isTimerEvent) TimerEventsCallBack();
  65   2              }
  66   1      }
  67          
  68          void SetZero(){
  69   1              LCDPrintScreen("Cross Probes And","Press Any Button");
  70   1              PressAnyKey();                                                                                          //等待用户按照指示短接红黑表笔
  71   1              LCDPrintScreen("Mearsuring...","Please Wait");
  72   1              capSel=CAPSEL_LOWR;                                                                                     //先归零低档位
  73   1              delaynms(3000);                                                                                         //等待某些反应迟钝的用户
  74   1              StartTimer();                                                                                           //开始采样
  75   1              while(!isTimerEvent);
  76   1              GetRVal();                                                                                                      //低档位采样结束，算出低档位下的“标准N”
  77   1              refLowRN=curN;
  78   1              capSel=CAPSEL_HIGHR;                                                                            //设定到高档位，并等待0.2秒，让继电器反应过来
  79   1              delaynms(200);
  80   1              StartTimer();                                                                                           //高档位采样
  81   1              while(!isTimerEvent);
  82   1              GetRVal();
  83   1              refHighRN=curN;
  84   1              LCDPrintScreen("Set Zero","Finished");                                          //调0完毕
  85   1              delaynms(2000);
  86   1              if(IsDebug){                                                                                            //调试模式下，显示调0测量结果
  87   2                      LCDCls();
  88   2                      LCDPrintStr(0,0,"LOW");
  89   2                      LCDPrintNum(6,0,refLowRN);
  90   2                      LCDPrintStr(0,1,"HIGH");
  91   2                      LCDPrintNum(6,1,refHighRN);
  92   2              }
  93   1      }
  94          
  95          void KeyEventsCallBack(){
  96   1              switch(key1Events){
  97   2                      case SHORT_PRESS:
  98   2                              LCDPrintScreen("KEY1","SHORT_PRESS");
  99   2                              break;
 100   2                      case LONG_PRESS:
 101   2                              LCDPrintScreen("KEY1","LONG_PRESS");
 102   2                              break;
 103   2              }
 104   1              switch(key2Events){
 105   2                      case SHORT_PRESS:
 106   2                              LCDPrintScreen("KEY2","SHORT_PRESS");
 107   2                              break;
 108   2                      case LONG_PRESS:
 109   2                              LCDPrintScreen("KEY2","LONG_PRESS");
 110   2                              break;
 111   2              }
 112   1              switch(key3Events){
 113   2                      case SHORT_PRESS:
 114   2                              LCDPrintScreen("KEY3","SHORT_PRESS");
 115   2                              break;
 116   2                      case LONG_PRESS:
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/19/2018 13:55:33 PAGE 3   

 117   2                              LCDPrintScreen("KEY3","LONG_PRESS");
 118   2                              break;
 119   2              }
 120   1              RstKeyEvents();
 121   1              PressAnyKey();          
 122   1      }
 123          
 124          void TimerEventsCallBack(){
 125   1              GetRVal();
 126   1              StartTimer();
 127   1              LCDCls();
 128   1              LCDPrintStr(0,0,"R=");
 129   1              LCDPrintFloat(2,0,curRValue);
 130   1              LCDPrintChar(15,0,0x00);
 131   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    378    ----
   CONSTANT SIZE    =    128    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
