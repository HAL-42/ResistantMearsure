C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/21/2018 01:07:47 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE RESISTANTMEASURE
OBJECT MODULE PLACED IN .\ResistantMeasure.obj
COMPILER INVOKED BY: D:\Kell\C51\BIN\C51.EXE ..\Src\ResistantMeasure.c BROWSE DEBUG OBJECTEXTEND PRINT(.\ResistantMeasur
                    -e.lst) OBJECT(.\ResistantMeasure.obj)

line level    source

   1          #include "RM.h"
   2          #include "LCD1602.h"
   3          #include "Key.h"
   4          #include "Timer.h"
   5          #include "Menu.h"
   6          
   7          //----------------------------LEDå…³å…¨å±€å˜é‡-------------------------------//
   8          sbit    Led1 = P1^0;
   9          sbit    Led2 = P1^1;
  10          sbit    Led3 = P1^2;
  11          
  12          //-------------------------æŒ‰é”®ç›¸å…³å…¨å±€å˜é‡-------------------------------//
  13          sbit key1=P1^5;                                 //æ³¨æ„ä½ç”µå¹³è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹
  14          sbit key2=P1^4;
  15          sbit key3=P1^3;
  16          
  17          uchar key1Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  18          uchar key2Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  19          uchar key3Events;                       //ä¿å­˜Key1æœªå¤„ç†çš„è¾“å…¥ä¿¡å·
  20          
  21          bit isKeyEvents;                        //è®°å½•æ˜¯å¦æœ‰æŒ‰é”®äº‹ä»¶å‘ç”Ÿ
  22          
  23          //-------------------------è®¡æ—¶å™¨ç›¸å…³å…¨å±€å˜é‡-----------------------------//
  24          uchar timerFun;                         //é€‰æ‹©è®¡æ—¶å™¨ä½œç”¨
  25          
  26          sbit capSel=P2^4;                       //ç”µå®¹é€‰æ‹©æ¥å£
  27          float curRValue;                        //å½“å‰æµ‹å¾—ç”µé˜»é˜»å€¼
  28          bit isTimerEvent;                       //è®°å½•æ˜¯å¦æœ‰å®šæ—¶å™¨äº‹ä»¶å‘ç”Ÿï¼ˆå®Œæˆä¸€æ¬¡é¢‘ç‡æµ‹é‡ï¼‰
  29          long curN;                                      //å½“å‰æµ‹å¾—è„‰å†²æ•°
  30          float curFreqE5;                        //å½“å‰æµ‹å¾—é¢‘ç‡
  31          long refLowRN;                          //ä½æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  32          long refHighRN;                         //é«˜æ¡£ä½ä¸‹å‚è€ƒè„‰å†²æ•°
  33          
  34          //-------------------------ç­›é€‰å™¨ç›¸å…³å…¨å±€å˜é‡-----------------------------//
  35          bit isSieveOn;                  //ç­›é€‰å™¨æ˜¯å¦æ‰“å¼€
  36          float errTolr;                  //ç­›é€‰å™¨å…è®¸è¯¯å·®
  37          float sieveRVal;                //ç­›é€‰å™¨ä¸­å¿ƒå€¼
  38          
  39          //-------------------------è°ƒè¯•æ¨¡å¼ç›¸å…³å…¨å±€å˜é‡---------------------------//
  40          bit isDebug=1;                          //æ˜¯å¦å¤„äºè°ƒè¯•æ¨¡å¼
  41          
  42                  ///////////////////
  43                  //TODO:å®Œå–„ä»¥ä¸‹å‡½æ•° //
  44                  ///////////////////
  45          void InitialSys();
  46          void SetZero();
  47          void KeyEventsCallBack();
  48          void TimerEventsCallBack();
  49          
  50          void main(){
  51   1              InitialSys();
  52   1              while(1){
  53   2                      SetZero();
  54   2                      Led1=Led2=Led3=0;
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/21/2018 01:07:47 PAGE 2   

  55   2              }
  56   1              StartTimer();
  57   1              while(1){
  58   2                      KeyScan();
  59   2                      if(isKeyEvents) KeyEventsCallBack();
  60   2                      if(isTimerEvent) TimerEventsCallBack();
  61   2              }
  62   1      }
  63          
  64          void InitialSys(){
  65   1              //å®šä¹‰ç«¯å£è¾“å…¥è¾“å‡º,p1^0-P1^2ä¸ºæ¨æŒ½è¾“å‡ºï¼Œp1^3-P1^7ä¸ºè¾“å…¥ï¼Œè®¾ç½®PxM0ï¼ŒPxM1ï¼›å…³é—­å„ä
             -¸ªLED
  66   1              P1M1 = 0x07;                                                            //8'b00000111
  67   1              P1M0 = 0xf8;                                                            //8'b11111000
  68   1              P3M1 = 0x80;                                                            //8'b10000000
  69   1              P3M0 = 0x20;                                                            //8'b00100000
  70   1              Led1=Led2=Led3=0;
  71   1              //åˆå§‹åŒ–å…¶ä»–å¤–å›´è®¾å¤‡
  72   1              InitialTimers();                                                        //åˆå§‹åŒ–è®¡æ—¶å™¨    
  73   1              KeyInitial();                                                           //åˆå§‹åŒ–é”®ç›˜
  74   1              //åˆå§‹åŒ–å…¶ä»–å°šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡
  75   1              isSieveOn=0;
  76   1              errTolr=0.0;
  77   1              errTolr=0.0;
  78   1              isDebug=1;
  79   1      }
  80          
  81          void SetZero(){
  82   1              extern uchar t1IntrTimes;
  83   1              extern uchar t0IntrTimes;
  84   1              LCDPrintScreen("Cross Probes And","Press Any Button");
  85   1              PressAnyKey();                                                                                          //ç­‰å¾…ç”¨æˆ·æŒ‰ç…§æŒ‡ç¤ºçŸ­æ¥çº¢é»‘è¡¨ç¬”
  86   1              LCDPrintScreen("Mearsuring...","Please Wait");
  87   1              capSel=CAPSEL_LOWR;                                                                                     //å…ˆå½’é›¶ä½æ¡£ä½
  88   1              delaynms(3000);                                                                                         //ç­‰å¾…æŸäº›ååº”è¿Ÿé’çš„ç”¨æˆ·
  89   1              StartTimer();                                                                                           //å¼€å§‹é‡‡æ ·
  90   1              while(!isTimerEvent);
  91   1              GetRVal();                                                                                                      //ä½æ¡£ä½é‡‡æ ·ç»“æŸï¼Œç®—å‡ºä½æ¡£ä½ä¸‹çš„â€œæ ‡å‡†Nâ€
  92   1              if(!TL1) Led1=1;
  93   1              refLowRN=curN;
  94   1              capSel=CAPSEL_HIGHR;                                                                            //è®¾å®šåˆ°é«˜æ¡£ä½ï¼Œå¹¶ç­‰å¾…0.2ç§’ï¼Œè®©ç»§ç”µå™¨ååº”è¿‡æ¥
  95   1              delaynms(1000);
  96   1              StartTimer();                                                                                           //é«˜æ¡£ä½é‡‡æ ·
  97   1              while(!isTimerEvent);
  98   1              GetRVal();
  99   1              if(!TL1) Led3=1;
 100   1              refHighRN=curN;
 101   1              LCDPrintScreen("Set Zero","Finished");                                          //è°ƒ0å®Œæ¯•
 102   1              delaynms(2000);
 103   1              if(isDebug){                                                                                            //è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºè°ƒ0æµ‹é‡ç»“æœ
 104   2                      LCDCls();
 105   2                      LCDPrintStr(0,0,"LOW");
 106   2                      LCDPrintNum(6,0,refLowRN);
 107   2                      LCDPrintStr(0,1,"HIGH");
 108   2                      LCDPrintNum(6,1,refHighRN);
 109   2                      PressAnyKey();
 110   2              }
 111   1      }
 112          
 113          void KeyEventsCallBack(){
 114   1              switch(key1Events){
 115   2                      case SHORT_PRESS:
C51 COMPILER V9.01   RESISTANTMEASURE                                                      07/21/2018 01:07:47 PAGE 3   

 116   2                              LCDPrintScreen("KEY1","SHORT_PRESS");
 117   2                              break;
 118   2                      case LONG_PRESS:
 119   2                              LCDPrintScreen("KEY1","LONG_PRESS");
 120   2                              break;
 121   2              }
 122   1              switch(key2Events){
 123   2                      case SHORT_PRESS:
 124   2                              LCDPrintScreen("KEY2","SHORT_PRESS");
 125   2                              break;
 126   2                      case LONG_PRESS:        
 127   2                              LCDPrintScreen("KEY2","LONG_PRESS");
 128   2                              break;
 129   2              }
 130   1              switch(key3Events){
 131   2                      case SHORT_PRESS:
 132   2                              LCDPrintScreen("KEY3","SHORT_PRESS");
 133   2                              break;
 134   2                      case LONG_PRESS:
 135   2                              LCDPrintScreen("KEY3","LONG_PRESS");
 136   2                              break;
 137   2              }
 138   1              RstKeyEvents();
 139   1              PressAnyKey();          
 140   1      }
 141          
 142          void TimerEventsCallBack(){
 143   1              GetRVal();
 144   1              StartTimer();
 145   1              LCDCls();
 146   1              LCDPrintStr(0,0,"R=");
 147   1              LCDPrintFloat(2,0,curRValue);
 148   1              if(isDebug){
 149   2                      LCDPrintNum(8,1,curN);
 150   2              }
 151   1              else{
 152   2                      LCDErase(8,1,8);
 153   2              }
 154   1              if(isSieveOn){
 155   2                      LCDPrintChar(15,0,0x00);
 156   2                      if( (curRValue-sieveRVal)/sieveRVal < errTolr &&
 157   2                              (curRValue-sieveRVal)/sieveRVal > -errTolr ){
 158   3                              LCDPrintStr(0,1,"In ");
 159   3                      }
 160   2                      else{
 161   3                              LCDPrintStr(0,1,"Out");
 162   3                      }
 163   2              }
 164   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    589    ----
   CONSTANT SIZE    =    136    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
